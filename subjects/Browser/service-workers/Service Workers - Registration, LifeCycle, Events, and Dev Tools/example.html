<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script type="module">
      function longTask() {
        const arr = [];
        const date = Date.now();
        const random = () => Math.random() * 30 + 1
        for (let index = 0; index < 50_000_000; index++) {
          arr[index] = Math.sqrt(index) * Math.pow(index, 10);

          document.querySelector('#button').parentElement.style.border = `1px solid #ccc${random().toString(16)}`
        }

        console.log('finish', Date.now() - date);
      }

      const registration = await navigator.serviceWorker.register('./service-worker.js');
      // registration.
      console.log(registration.active, registration.installing, registration.waiting);

      // Get service worker when that is active/ready
      navigator.serviceWorker.ready.then((cont) => {
        console.log('ready', cont.active);
      });

      // Get all registrations
      document.querySelector('#unregister').addEventListener('click', () => {
        navigator.serviceWorker.getRegistrations().then((regists) => {
          console.log('registration', regists);
          for (const regist of regists) {
            regist.unregister();
          }
        });
      })

      document.querySelector('#button').addEventListener('click', () => {
        console.log('click');
        
        registration.active.postMessage('hey');


        // longTask();
      });
    </script>
  </head>
  <body>
    hey jude

    <button id="button">Button</button>
    <button id="unregister">Unregister</button>
  </body>
</html>
